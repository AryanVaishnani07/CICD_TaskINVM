name: Deploy to Ubuntu VM via Self-Hosted Runner

on:
  push:
    branches:
      - main  # Trigger workflow on push to main branch

jobs:
  deploy:
    runs-on: self-hosted   # Important: must use self-hosted runner

    steps:
    # 1️⃣ Checkout the repo
    - name: Checkout Repository
      uses: actions/checkout@v4

    # 2️⃣ Connect to VM (or local machine) and create hello.txt
    - name: Create hello.txt on VM
      run: |
        echo "Starting connection to VM..."
        
        # Using SSH to VM; adjust $VM_USER and $VM_HOST in secrets
        ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null \
            ${{ secrets.VM_USER }}@${{ secrets.VM_HOST }} << 'EOF'
          echo "Hello Aryan" > hello.txt
          echo "✔ hello.txt created successfully on VM!"
        EOF
